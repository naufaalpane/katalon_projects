@using System;
@using Toyota.Common.Web.Platform;

@{
    Layout = "~/Views/Shared/_Layout.cshtml";
}

@Html.Partial("_SearchCriteria")


@section HeadScript{

}

@Html.Partial("_UploadDataPopup")


<!-- Upload AREA-->
<div id="uploadDataFilePopup" class="modal fade" role="dialog" aria-hidden="true" aria-labelledby="basicModal">
    <div class="modal-dialog modal-md">
        <div class="modal-content">
            <div class="modal-header">
                <h4 class="modal-title" id="popup-title">Upload Area</h4>
            </div>

            <div class="modal-body">
                <div class="row">
                    <div class="col-md-12">
                        <!-- Dropzone AREA-->
                        <div id="actions" class="row">
                            <div class="col-md-12 fileinput-button mb-2">
                                <div class="row justify-content-center" style="padding: 5px;">
                                    <i class="fa fa-cloud-upload-alt fa-5x" style="opacity: 0.3"></i>
                                </div>
                                <div class="row justify-content-center" style="padding: 5px;">
                                    <span style="color: #999; font-size: 20px;"><i class="fa fa-caret-right blue" style="opacity: 0.7"></i> Drop file to upload <small>(or click)</small> </span>
                                </div>
                            </div>
                        </div>
                        <div class="row">
                            <div class="table table-striped" id="previews">
                                <div id="template" class="file-row">
                                    <div>
                                        <div class="progress progress-striped active" role="progressbar" aria-valuemin="0" aria-valuemax="100" aria-valuenow="0">
                                            <div class="progress-bar progress-bar-striped progress-bar-animated bg-info" style="width:0%;" data-dz-uploadprogress><span class="progress-text"></span></div>
                                        </div>
                                    </div>
                                </div>
                            </div>
                        </div>
                        <!-- Dropzone AREA-->
                    </div>
                </div>
            </div>
            <div class="modal-footer">
                <div class="col-xs-12 col-sm-6 col-md-6 col-lg-6">
                    <div class="text-left">

                    </div>
                </div>
                <div class="col-xs-12 col-sm-6 col-md-6 col-lg-6">
                    <div class="text-right">
                        <button type="button" class="btn btn-info" id="linkDownloadTemplate">Download Template </button>
                        <button type="button" id="btnUploadPopupClose" class="btn btn-default" data-dismiss="modal">Close</button>
                    </div>
                </div>
            </div>
        </div>
    </div>
</div>
@section BodyScript{
    <script type="text/javascript" src="@Url.Content("~/Content/Bootstrap/js/date-time/bootstrap-datepicker.js")"></script>
    <script type="text/javascript" src="@Url.Content("~/Content/js/common.js")"></script>
    <script type="text/javascript" src="@Url.Content("~/Content/tdk/jquery.bootstrap-growl.js")"></script>
    <script type="text/javascript" src="@Url.Content("~/Content/js/jquery.blockUI.js")"></script>
    <script type="text/javascript" src="@Url.Content("~/Content/js/jquery-msgbox/jquery.msgBox.js")"></script>
    <script type="text/javascript" src="@Url.Content("~/Content/tdk/jquery.filedownload.js")"></script>
    <script type="text/javascript" src="@Url.Content("~/Content/tdk/jquery.bootstrap-growl.min.js")"></script>

    <script type="text/javascript" src="@Url.Content("~/Content/Bootstrap/js/date-time/bootstrap-datepicker.js")"></script>

    <script>

        var trBaseColor;
        var dataEditCopy = [];
        var gScreenMode = "";
        var gDestCdList = [];

    $(document).ready(function () {



        $(document).on("click", "#insertLine", function () {
            gScreenMode = "Add";
            addTheFirstRow(this);
            dataEditCopy.length = 0;
        });

        $(document).on("click", "#cancelSubmit", function () {
            var tr = $(this).closest("tr");
            var tcFrom = $("#sc_TC_From").val();
            var tcTo = $("#sc_TC_To").val();
            var createdDt = $("#sc_Created_Dt").val();
            $("#tblDetail tbody tr").css("opacity", "1");
            $(".initialBtn").prop("disabled", false);
            if (tr.attr("class") == "editLine") {
                tr.each(function (i, e) {
                    $(e).removeClass($(e).attr("class"));
                    $(e).css("background-color", trBaseColor);
                    var i = $(e).children('td');
                    for (var x = 2; x <= i.length; x++) {
                        var val = i.eq(x).children().val();
                        i.eq(x).html(val);
                    }

                });
            } else {
                $(this).closest("tr").remove();
            }
            doSearch(1);
        });

        $(document).on("click", "#editLine", function () {
            gScreenMode = 'Edit'
            dataEditCopy.length = 0;
            var tr = initializeEditCopyLine(this);
            tr.addClass($(this).attr("id"));
            loopThrougTableRow(tr, $(this).attr('id'));
            $("#txtEq2").prop('disabled', true);

            trBaseColor = getComputedStyle(document.querySelector("." + $(this).attr('id') + "")).backgroundColor;
            tr.css("background-color", "#E9E9E9");

        });

        $(document).on("click", "#copyLine", function () {
            gScreenMode = 'Add'
            dataEditCopy.length = 0;
            addTheFirstRow(this);
        });

        $(document).on("click", "#btnDelDtl", function () {
            var checked = $(".grid-checkbox-body").length;

            if (checked < 1) {
                showErrorMesgGrowl("Choose one or more data(s) to be delete!");
            }
            else {
                //showConfirmMesg("Are you sure you want to delete the record?", onConfirmDelete, "Delete Confirmation");
                $.messagebox.show(
                "Delete Data",
                "MCSTSTD014C: Are you sure you want to delete the record ?",
                "INF",
                "CONFIRM",
                "onConfirmDelete()",
                ""
            );
                //$("#deleteConfirmation").modal();
            }
        });

        $(document).on("click", "#btnSave", function () {
            $.messagebox.show(
                "Delete Data",
                "MCSTSTD014C: Are you sure you want to save the record ?",
                "INF",
                "CONFIRM",
                "saveConfirm()",
                ""
            );

        });




    })
        function saveConfirm() {
              var params = new Object();
            var datas = new Object();

            params.ScreenMode = gScreenMode;
            params.data = datas;
            var errorinf = 0;

            if (gScreenMode === 'Add') {
                //ADD
                datas.HEIJUNKA_CD = $("#txtEq2").val();
                datas.HEIJUNKA_NAME = $("#txtEq3").val();


                //validasi
                if (datas.HEIJUNKA_CD == '' || datas.HEIJUNKA_CD == null) {
                    showErrorMesgGrowl("HEIJUNKA CODE should not be empty");
                    errorinf = 1;
                } else if (datas.HEIJUNKA_NAME == '' || datas.HEIJUNKA_NAME == null) {
                    showErrorMesgGrowl("HEIJUNKA NAME should not be empty");
                    errorinf = 1;
                }


            }
            else {
                datas.HEIJUNKA_CD = $("#txtEq2").val();
                datas.HEIJUNKA_NAME = $("#txtEq3").val();

                //validasi
                if (datas.HEIJUNKA_CD == '' || datas.HEIJUNKA_CD == null) {
                    showErrorMesgGrowl("HEIJUNKA CODE should not be empty");
                    errorinf = 1;
                } else if (datas.HEIJUNKA_NAME == '' || datas.HEIJUNKA_NAME == null) {
                    showErrorMesgGrowl("HEIJUNKA NAME should not be empty");
                    errorinf = 1;
                }

            }

            if (errorinf == 1) {

            }
            else {
               $.ajax({
                    type: 'POST',
                    url: '@Url.Content("HEIJUNKACodeNameMasterSettings/AddEditSave")',
                    contentType: 'application/json',
                    dataType: "json",
                    traditional: true,
                    data: JSON.stringify(params),
                    beforeSend: function () {
                        popUpProgressShow();
                        console.log(params);
                    },
                    success: function (data) {
                         if (data.Result == "ERROR") {
                             showErrorMesgGrowl(data.ErrMesgs);
                         }
                         else {
                             showSuccessMesgGrowl("Save Success");
                             onSaveSuccess();
                            }
                        popUpProgressHide();
                    },
                    error: function (data) {
                        popUpProgressHide();
                        showErrorMesgGrowl(data.ErrMesgs);
                    },
                    complete: function () {
                        popUpProgressHide();
                    }
                });
            }
        }
    function datePicker() {
        $( "._datepicker" ).datepicker({
            format: 'ddmmyyyy',
            autoclose: true,
            minViewMode: 'date',
            orientation: 'auto bottom'
        }).on('show', function () {
            $(".datepicker-orient-bottom").removeClass("datepicker-orient-bottom");
            $(".datepicker-dropdown").addClass("datepicker-orient-top");
        });
    }


    function addTheFirstRow(e) {
        btnAddRow_onClick(e);
        $(".initialBtn").prop("disabled", true);
        $("input[type=checkbox]").prop("checked", false);
    }

    function btnAddRow_onClick(classAttr) {
        var $class = $(classAttr).attr('id');
        var tr = $class == 'insertLine' ? $("#tblDetail tbody tr:first") : $(classAttr).closest("tr");
        $(".tableScroll").scrollTop(0);
        tr.clone().addClass($class).css("background-color", "#E9E9E9").prependTo("#tblDetail tbody");

        loopThrougTableRow($("#tblDetail tbody tr." + $class + ""), $class);


    }

    function initializeEditCopyLine(e) {
        var tr = $(e).closest("tr");
        $("input[type=checkbox]").prop("checked", false);
        $(".initialBtn").prop("disabled", true);

        return tr;
    }

    function loopThrougTableRow(tr, classAttr) {
        tr.each(function (i, e) {
            var i = $(e).children('td');
            for (var x = 2; x < i.length; x++) {
                var val = classAttr == "insertLine" ? "" : i.eq(x).text();
                i.eq(x).html("<input type ='text' class='form-control " + x + " text-center' value='" + val + "' id='txtEq" + x + "'/>");


                dataEditCopy.push(val);
            }
            i.eq(1).html(modifiedButton);

            datePicker();
        });


        $("#tblDetail tbody tr:not(." + tr.attr("class") + ")").css("opacity", "0.3");

    }
        function doSearch(page) {
            popUpProgressShow();

         $.ajax({
            type: "POST",
            url: "@Html.Toyota().Page.GetActionUrl("Search")",
             data: {
                 HEIJUNKA_CD: $("#txtSearchHEIJUNKACd").val(),

                rowsPerPage: $("#cbodisplay").val(),
                currentPage: page
            },
            success: function (data) {
                $("#gridTableCourse").html(data);
                popUpProgressHide();
            },
            error: function (data) {
                popUpProgressHide();
            }
        });
        }

        function doClear() {
            $("#txtSearchHEIJUNKACd").val(''),

            doSearch(1);
        }

        function onSaveSuccess() {

            doSearch(1);
            $(".initialBtn").prop("disabled", false);
            $("#previewUploadExcel").modal("hide");
        }

        @*delete multiple*@
        function onConfirmDelete() {
            popUpProgressShow();

            var DPPartsNoM_PxPCollection = [];
            var id = "";

            var data = new Object();
            data.listData = [];

            $(".grid-checkbox-body:checked").each(function () {
                var Data1 = new Object();
                Data1.HEIJUNKA_CD = $(this).attr('data-heijunkaCd');
                Data1.COMPANY_CD = $(this).attr('data-companyCd');


                data.listData.push(Data1);
            });

            $.ajax({
                type: 'POST',
                url: '@Url.Content("HEIJUNKACodeNameMasterSettings/Delete")',
                contentType: "application/json",
                dataType: "json",
                traditional: true,
                data: JSON.stringify(data),
                beforeSend: function () {
                    popUpProgressShow();
                },
                success: function (data) {
                    if (data.Result == "ERROR") {
                        showErrorMesgGrowl(data.ErrMesgs);
                    }
                    else {
                        showSuccessMesgGrowl("Delete Success");
                        doSearch(1);
                    }
                },
                error: function (data) {
                    showErrorMesgGrowl(data.ErrMesgs);
                },
                complete: function () {
                    popUpProgressHide();
                    $("#deleteConfirmation").modal("hide");
                }
            });
        }

        function onDeleteSingle(heijunka, companyCd) {

            $.messagebox.show(
                "Delete Data",
                "MCSTSTD014C: Are you sure you want to delete the record ?",
                "INF",
                "CONFIRM",
                "onConfirmDeleteSingle(" + "'" + heijunka + "'," + "'" + companyCd + "'" + ")",
                ""
            );
        }

        function onConfirmDeleteSingle(heijunka, companyCd) {
            popUpProgressShow();

            var listData = [];
            var id = "";

            var data = new Object();
            data.listData = [];

            var Data1 = new Object();
            Data1.COMPANY_CD = companyCd;
            Data1.HEIJUNKA_CD = heijunka;


            data.listData.push(Data1);


            $.ajax({
                type: 'POST',
                url: '@Url.Content("HEIJUNKACodeNameMasterSettings/Delete")',
                contentType: "application/json",
                dataType: "json",
                traditional: true,
                data: JSON.stringify(data),
                beforeSend: function () {
                    popUpProgressShow();
                },
                success: function (data) {
                    if (data.Result == "ERROR") {
                        showErrorMesgGrowl(data.ErrMesgs);
                    }
                    else {
                        showSuccessMesgGrowl("Delete Success");
                        popUpProgressHide();
                        doSearch(1);
                    }
                },
                error: function (data) {
                    showErrorMesgGrowl(data.ErrMesgs);
                },
                complete: function () {
                    popUpProgressHide();
                    $("#deleteConfirmation").modal("hide");
                }
            });
        }





    </script>
}